<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="">
    <meta property="og:title" content="CRM / Plugin Generated Values - and Reducing Roundtrips!">
    

  
  
  <meta name="twitter:title" content="CRM / Plugin Generated Values - and Reducing Roundtrips!"/>
  <meta name="twitter:description" content="Setting the Scene

Imagine we have an application that uses the CRM SDK. It needs to:


Create a new account entity in crm.
Get some value that was just generated as a result of a synchronous plugin that fires on the create. For example, suppose there is a plugin that generates an account reference number.


The &ldquo;I don&rsquo;t care about network latency method!&rdquo;

The &lsquo;I don&rsquo;t care about network latency&rsquo; way of dealing with this is to just do 2 seperate Requests (roundtrips) with the CRM server.


Create the new account which returns you the ID.
Retrieve the account using that ID, along with the values that you need.


This approach is sub optimal where network latency is a concern, as it incurs the penalty of making two roundtrips accross the network with the server, where 1 is possible.

Let&rsquo;s now have a look at the &ldquo;I&rsquo;m running on a 56k modem method&rdquo; of doing the same thing!
"/>
  
    <meta name="twitter:site" content="@dazinator"/>
  
  
  

    
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="2014-12-22">
    
    <meta property="og:description" content="">
    <meta property="og:url" content="http://darrelltunnell.net/blog/2014/12/22/crm-plugin-generated-values-and-reducing-roundtrips/">
    <meta property="og:site_name" content="Darrell Tunnell">
    
    <meta property="og:tags" content="Dynamics CRM">
    
    <meta name="generator" content="Hugo 0.29" />
    <title>CRM / Plugin Generated Values - and Reducing Roundtrips! &middot; Darrell Tunnell</title>
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/styles/default.min.css">
    
    <link rel="stylesheet" href="http://darrelltunnell.net/css/style.css">    
    
    <link href="" rel="alternate" type="application/rss+xml" title="Darrell Tunnell" />
    
    
    <link rel="icon" href="http://darrelltunnell.net/favicon.ico" />
    
    <style>
     
.highlight pre {
    word-wrap: normal;
}

.highlight pre code {
    white-space: pre;
}

    </style>

    
    
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top visible-xs">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
				<a class="navbar-brand" href="http://darrelltunnell.net/">Darrell Tunnell</a>
			
		</div>
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				
				
					<li><a href="http://darrelltunnell.net/">Home</a></li>
				
					<li><a href="http://darrelltunnell.net/post/">Posts</a></li>
				
					<li><a href="http://darrelltunnell.net/tutorial/">Tutorials</a></li>
				
			</ul>
		</div>
	</div>
</nav>
<div class="container-fluid">
	<div class="row">
		<div id="menu" class="hidden-xs col-sm-4 col-md-3">
	<div id="menu-content" class="vertical-align">
		
			<h1 class="text-center"><a href="http://darrelltunnell.net/">Darrell Tunnell</a></h1>
		
		
		
			<small class="text-center center-block">Radiating Awesomeness, One Blog Post at a Time.</small>
		
		
		
			<img id="profile-pic" src="http://darrelltunnell.net//img/profile.jpg" alt="My Picture" class="img-circle center-block">
		
		<div id="social" class="text-center">
			
				<a href="https://github.com/dazinator"><i class="fa fa-github fa-2x"></i></a>
			
				<a href="https://twitter.com/dazinate"><i class="fa fa-twitter fa-2x"></i></a>
			
				<a href="https://uk.linkedin.com/in/darrell-tunnell-33845331"><i class="fa fa-linkedin fa-2x"></i></a>
			
				<a href="http://darrelltunnell.net/index.xml"><i class="fa fa-rss-square fa-2x"></i></a>
			

			<a href="mailto:darrelltunnell@gmail.com"><i class="fa fa-envelope-o fa-2x"></i></a>
		</div>
		<div id="links" class="text-center">
			
			
				<a href="http://darrelltunnell.net/">Home</a>
			
				<a href="http://darrelltunnell.net/post/">Posts</a>
			
				<a href="http://darrelltunnell.net/tutorial/">Tutorials</a>
			
		</div>
	</div>
</div>

		<div id="content" class="col-xs-12 col-sm-8 col-md-9">
			<div class="row">
				<div id="post" class="col-sm-offset-1 col-sm-10 col-md-10 col-lg-8">

<main>
	<header>
		<h1>CRM / Plugin Generated Values - and Reducing Roundtrips!</h1>
	</header>

	<article>
		<h3 id="setting-the-scene">Setting the Scene</h3>

<p>Imagine we have an application that uses the CRM SDK. It needs to:</p>

<ol>
<li>Create a new <code>account</code> entity in crm.</li>
<li>Get some value that was just generated as a result of a synchronous plugin that fires on the create. For example, suppose there is a plugin that generates an account reference number.</li>
</ol>

<h3 id="the-i-don-t-care-about-network-latency-method">The &ldquo;I don&rsquo;t care about network latency method!&rdquo;</h3>

<p>The &lsquo;I don&rsquo;t care about network latency&rsquo; way of dealing with this is to just do 2 seperate Requests (roundtrips) with the CRM server.</p>

<ol>
<li>Create the new <code>account</code> which returns you the ID.</li>
<li>Retrieve the <code>account</code> using that ID, along with the values that you need.</li>
</ol>

<p>This approach is sub optimal where network latency is a concern, as it incurs the penalty of making two roundtrips accross the network with the server, where 1 is possible.</p>

<p>Let&rsquo;s now have a look at the &ldquo;I&rsquo;m running on a 56k modem method&rdquo; of doing the same thing!
</p>

<h3 id="the-i-m-running-on-a-56k-modem-method-this-weeks-pro-tip">The &ldquo;I&rsquo;m running on a 56k modem method&rdquo; - this weeks pro tip!</h3>

<p>For quite some time now - as of <code>CRM 2011 Update Rollup 12 - (SDK 5.0.13)</code> you can utilise the <a href="http://msdn.microsoft.com/en-gb/library/jj863604.aspx">Execute Multiple</a> request to do this kind of thing in one roundtrip with the CRM server.</p>

<p>Here is an example of creating an account, and retrieiving it in a single round trip:</p>

<table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"><code class="language-csharp" data-lang="csharp"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50</code></pre></div></td><td class="code"><div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><code class="language-csharp" data-lang="csharp"><span></span> 				 <span style="color: #408080; font-style: italic">// Create an ExecuteMultipleRequest object.</span>
                <span style="color: #B00040">var</span> multipleRequests = <span style="color: #008000; font-weight: bold">new</span> ExecuteMultipleRequest()
                {
                    <span style="color: #408080; font-style: italic">// Assign settings that define execution behavior: continue on error, return responses. </span>
                    Settings = <span style="color: #008000; font-weight: bold">new</span> ExecuteMultipleSettings()
                    {
                        ContinueOnError = <span style="color: #008000; font-weight: bold">false</span>,
                        ReturnResponses = <span style="color: #008000; font-weight: bold">true</span>
                    },
                    <span style="color: #408080; font-style: italic">// Create an empty organization request collection.</span>
                    Requests = <span style="color: #008000; font-weight: bold">new</span> OrganizationRequestCollection()
                };

                <span style="color: #B00040">var</span> entity = <span style="color: #008000; font-weight: bold">new</span> Entity(<span style="color: #BA2121">&quot;account&quot;</span>);
                entity.Id = Guid.NewGuid();
                entity[<span style="color: #BA2121">&quot;name&quot;</span>] = <span style="color: #BA2121">&quot;experimental test&quot;</span>;

                CreateRequest createRequest = <span style="color: #008000; font-weight: bold">new</span> CreateRequest
                {
                    Target = entity
                };

                RetrieveRequest retrieveRequest = <span style="color: #008000; font-weight: bold">new</span> RetrieveRequest
                {
                    Target = <span style="color: #008000; font-weight: bold">new</span> EntityReference(entity.LogicalName, entity.Id),
                    ColumnSet = <span style="color: #008000; font-weight: bold">new</span> ColumnSet(<span style="color: #BA2121">&quot;createdon&quot;</span>) <span style="color: #408080; font-style: italic">// list the fields that you want here</span>
                };

                multipleRequests.Requests.Add(createRequest);
                multipleRequests.Requests.Add(retrieveRequest);

                <span style="color: #408080; font-style: italic">// Execute all the requests in the request collection using a single web method call.</span>
                ExecuteMultipleResponse responseWithResults = (ExecuteMultipleResponse)orgService.Execute(multipleRequests);
                             
                <span style="color: #B00040">var</span> createResponseItem = responseWithResults.Responses[<span style="color: #666666">0</span>];
                CreateResponse createResponse = <span style="color: #008000; font-weight: bold">null</span>;
                <span style="color: #008000; font-weight: bold">if</span> (createResponseItem.Response != <span style="color: #008000; font-weight: bold">null</span>)
                {
                    createResponse = (CreateResponse)createResponseItem.Response;
                }

                <span style="color: #B00040">var</span> retrieveResponseItem = responseWithResults.Responses[<span style="color: #666666">1</span>];

                RetrieveResponse retrieveResponse = <span style="color: #008000; font-weight: bold">null</span>;
                <span style="color: #008000; font-weight: bold">if</span> (retrieveResponseItem.Response != <span style="color: #008000; font-weight: bold">null</span>)
                {
                    retrieveResponse = (RetrieveResponse)retrieveResponseItem.Response;
                }

                Console.Write(retrieveResponse.Entity[<span style="color: #BA2121">&quot;createdon&quot;</span>]); <span style="color: #408080; font-style: italic">// yup - we got the value we needed!</span>
</code></pre></div>
</td></tr></table>

<h3 id="what-happened">What happened?</h3>

<p>Both the CreateRequest, and the RetrieveRequest (for the created entity) are batched up into a single Request and shipped off to the CRM server for processing.</p>

<p>CRM processed them in that order, collated the responses together, and returned them in a single batch.</p>

<h3 id="caveats">Caveats</h3>

<p>One caveat of this approach is that, if you intend to grab the generated values for an entity that is being created, then you need to know in advance what the ID will be.</p>

<p>This means you have to specify the ID of the entity when you create it yourself - you can&rsquo;t let CRM auto create the new ID.</p>

<p>For updates / deletes this is a non issue, as the ID is allready known.</p>

<h3 id="last-thoughts-sql-optimisation">Last thoughts - SQL Optimisation</h3>

<p>I speculate that specifying your own ID&rsquo;s <em>might be a bad thing</em> if you don&rsquo;t use Sequential Guid&rsquo;s.</p>

<p>When CRM generates Id&rsquo;s for you, it generates them sequentially, and I beleive there may be SQL performance benefits to this in terms of index optimisation etc. So if using Guid.NewGuid() to create your new Id&rsquo;s you may want to check with a SQL guru first to understand any impact of using random Guid&rsquo;s as Id&rsquo;s on performance of the CRM tables! That said - Microsoft do support this, so it can&rsquo;t be too bad..</p>
	</article>
</main>

 <div class="share">
        
            <a class="icon-twitter" href="https://twitter.com/share?text=CRM%20%2f%20Plugin%20Generated%20Values%20-%20and%20Reducing%20Roundtrips%21&url=http%3a%2f%2fdarrelltunnell.net%2fblog%2f2014%2f12%2f22%2fcrm-plugin-generated-values-and-reducing-roundtrips%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fa fa-twitter"></i>
                <span class="hidden">Twitter</span>
            </a>
        

        

        
            <a class="icon-google-plus" href="https://plus.google.com/share?url=http%3a%2f%2fdarrelltunnell.net%2fblog%2f2014%2f12%2f22%2fcrm-plugin-generated-values-and-reducing-roundtrips%2f"
              onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
              <i class="fa fa-google-plus"></i>
                <span class="hidden">Google+</span>
            </a>
        
        
            <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&title=CRM%20%2f%20Plugin%20Generated%20Values%20-%20and%20Reducing%20Roundtrips%21&url=http%3a%2f%2fdarrelltunnell.net%2fblog%2f2014%2f12%2f22%2fcrm-plugin-generated-values-and-reducing-roundtrips%2f&summary="
               onclick="window.open(this.href, 'linkedin-share', 'width=554,height=481');return false;">
               <i class="fa fa-linkedin"></i>
               <span class="hidden">LinkedIn</span>
            </a>
        
    </div>

<div id="bottom-nav" class="text-center center-block">
	<a href=" http://darrelltunnell.net/" class="btn btn-default"><i class="fa fa-home"></i> Home</a>
</div>


  <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "darrelltunnellsblog" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


						</div>
					</div>
				</div>
			</div>
    </div>
  
 
  
  <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'code-here', 'auto');
    ga('send', 'pageview');
    window.baseURL = "http:\/\/darrelltunnell.net\/";
  </script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
  
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script>
  
  <script src="http://darrelltunnell.net//js/App.js"></script>
  
  <script type="text/javascript">   
  $(document).ready(function () {
	$( ".highlighttable" ).wrap("<div class='table-responsive'></div>");
  $( "img" ).addClass("img-responsive");
});
</script>
    
</body>
</html>
